<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Collapsible Tree Example</title>

    <style>

	.node circle {
	  fill: #fff;
	  stroke: steelblue;
	  stroke-width: 3px;
	}

	.node text { font: 12px sans-serif; }

	.link {
	  fill: none;
	  stroke: #ccc;
	  stroke-width: 2px;
	}
	
    </style>

  </head>

  <body>

<!-- load the d3.js library -->	
<script src="http://d3js.org/d3.v3.min.js"></script>
	
<script>

// ************** Generate the tree diagram	 *****************
var margin = {top: 20, right: 120, bottom: 20, left: 120},
	width = 960 - margin.right - margin.left,
	height = 500 - margin.top - margin.bottom;
	
var i = 0;

var tree = d3.layout.tree()
	.size([height, width]);

var diagonal = d3.svg.diagonal()
	.projection(function(d) { return [d.y, d.x]; });

var svg = d3.select("body").append("svg")
	.attr("width", width + margin.right + margin.left)
	.attr("height", height + margin.top + margin.bottom)
  .append("g")
	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// load the external data
//Loads the complete json
//Object { name: "Top Level", parent: "null", children: Array[2] }
d3.json("./sampleData.json", function(error, treeData) {
  upstream = treeData[0]["upstream"];
  downstream = treeData[0]["downstream"];
  //console.log(upstream);
  update(upstream,180);
  update(downstream,-180);
});

function update(source,depth_factor) {
	//source will have the complete data
	//without var you have the variable declared as global. So accessible.
	//console.log(source);

  // Compute the new tree layout.
  //console.log(source);
  var nodes = tree.nodes(source).reverse(),
  //var node_right = tree.nodes(source.downstream).reverse(), //Not global
	  links = tree.links(nodes); //global
//console.log(tree.nodes(source));
//console.log(nodes); //gets you all the nodes //MyCode: Array [ Array[2] ] Original Code: Array [ Object, Object, Object, Object, Object ]
//console.log(links) //gets you all the links Array [ Object, Object, Object, Object ]



  // Normalize for fixed-depth.
  nodes.forEach(function(d) { d.y = d.depth * depth_factor; });

  // Declare the nodes…
  //This is where the data is read 
  var node = svg.selectAll("gnode") //what does this g.node do??? Need to explore
	  .data(nodes, function(d) { //console.log(d.id);
	  	return d.id || (d.id = i++); });

//console.log(nodes[0]);





  // Enter the nodes.
  var nodeEnter = node.enter().append("g")
	  .attr("class", "nodes")
	  .attr("transform", function(d) { 
		  return "translate(" + (d.y+(width/2)) + "," + d.x + ")"; }); //svg x,y co-ordinates

//for varying shapes use path and keep retrofitting as per conveniance
//This d.id === i-1 may come to bite you as the code exapnds. I guess

  nodeEnter.append("path")
  			.attr("class","node")
  			.style("fill", function(d){ return d.id === i-1 ? "green":"steelblue";})
      		.style("stroke", "white")
      		.style("stroke-width", "1.5px")
      		.on("mouseover", function(d) {
      			if(d.children){
      				d3.select(this).style("fill","red");
      				
      				d3.selectAll("path.link").style("stroke-width","5.5px"); // this should be stroke 
      				
      				var child = d3.selectAll("path.node");
      				child.filter(function(x){return d.id != x.id}).style("fill","pink"); //Works absolutely fine

      				//This is good logic may be needed but need recursive action not iterative . 
      				/*d.children.forEach(function(c,i){
      					console.log(c.children);
      					childNodes[i] = c;
      					d3.selectAll("path.link").style("fill","black");
      					//console.log(c);
      					//console.log(i);
      					//d3.select(this).style("fill","black");
      				})*/
      				
      			}
      		})
      		
      		.on("mouseout", function(d){
      			if(d.children){
      				d3.select(this).style("fill","green");
      				d3.selectAll("path.link").style("stroke-width","1.5px"); // this should be stroke 
      				
      				var child = d3.selectAll("path.node");
      				child.filter(function(x){return d.id != x.id}).style("fill","steelblue"); //Works absolutely fine
      			}
      		})
  			.attr("d", d3.svg.symbol()
  				.size(function(d){ return d.id === i-1 ? "600":"150";})
  				.type(function(d){ return d.id === i-1 ? "square":"circle";}));
  			


  nodeEnter.append("text")
	  .attr("x", function(d) { 
		  return d.children || d._children ? -13 : 13; })
	  .attr("dy", ".35em")
	  .attr("text-anchor", function(d) { 
		  return d.children || d._children ? "end" : "start"; })
	  .text(function(d) { return d.name; })
	  .style("fill-opacity", 1);

  // Declare the links…
  var link = svg.selectAll("path.link")
	  .data(links, function(d) { return d.target.id; });

  // Enter the links.
  link.enter().insert("path", "g")
	  .attr("class", "link")
	  .attr("transform","translate("+width/2+",0)")
	  .attr("d", diagonal);

}


//Pending shape of the col can it be improved ????


//mouseover funstionality this is easy.






</script>
	
  </body>
</html>
